
#ifndef __CUDF__
#define __CUDF__

#include "conda-ml-env"

RUN apt-get update && \\
    apt-get install -y --no-install-recommends \\
        libboost-all-dev && \\
    rm -rf /var/lib/apt/lists && \\
    mkdir /var/lib/apt/lists

RUN conda install -c numba -c conda-forge -c nvidia -c rapidsai -c defaults \\
        cffi \\
        cmake \\
        Cython \\
        llvmlite \\
        numba \\
        nvstrings \\
        pandas=0.20.3 \\
        pyarrow && \\
    conda clean -ya

ENV NUMBAPRO_NVVM=/usr/local/cuda/nvvm/lib64/libnvvm.so
ENV NUMBAPRO_LIBDEVICE=/usr/local/cuda/nvvm/libdevice/

RUN git clone --recursive -b v0.3.0 "https://github.com/rapidsai/cudf" /opt/cudf && \\
    cd /opt/cudf && \\
    mkdir -p cpp/build && \\
    cd cpp/build && \\
    cmake .. -DCMAKE_INSTALL_PREFIX=${CONDA_PREFIX} && \\
    make -j && \\
    make install && \\
    make python_cffi && \\
    make install_python && \\
    cd ../../python && \\
    python setup.py build_ext --inplace && \\
    python setup.py install && \\
    cd /opt && \\
    rm -rf /opt/cudf

RUN git clone "https://github.com/rapidsai/dask-cudf" /opt/dask-cudf && \\
    cd /opt/dask-cudf && \\
    python setup.py install && \\
    cd /opt && \\
    rm -rf /opt/dask-cudf

#endif // __CUDF__
